<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechStore - Tienda Virtual</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="logo">
            <i class="fas fa-microchip"></i>
            TechStore
        </div>
        <div class="user-controls">
            <div id="admin-badge-container" style="display: none;">
                <span class="admin-badge">ADMIN</span>
            </div>
            <div id="user-display">Cargando...</div>
            
            <div class="cart-btn-container" id="cart-btn">
                <i class="fas fa-shopping-cart cart-icon"></i>
                <span class="cart-count" id="cart-count">0</span>
            </div>

            <button id="logout-btn" style="width: auto; padding: 8px 15px;">Salir</button>
        </div>
    </header>

    <div class="container">
        <!-- Admin Dashboard Section -->
        <div id="admin-panel" class="admin-controls" style="display: none;">
            <h3>Panel de Administración</h3>
            <div style="display: flex; gap: 10px;">
                <button onclick="openProductModal()" class="btn-buy" style="width: auto;">+ Nuevo Producto</button>
                <button onclick="openAdminRegisterModal()" class="btn-edit" style="width: auto;">+ Registrar Admin</button>
            </div>
        </div>

        <h2 style="text-align: left; margin-top: 1rem;">Productos Disponibles</h2>
        <div id="products-grid" class="products-grid">
            <!-- Products will be loaded here -->
            <div class="loader"></div>
        </div>
    </div>

    <!-- Shopping Cart Modal -->
    <div id="cart-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('cart-modal')">&times;</span>
            <h2>Carrito de Compras</h2>
            <div id="cart-items">
                <p style="text-align: center; color: #aaa;">Tu carrito está vacío.</p>
            </div>
            <div class="cart-total">
                Total: $<span id="cart-total-amount">0.00</span>
            </div>
            <button id="checkout-btn" style="margin-top: 1.5rem;" onclick="checkout()">Comprar Ahora</button>
        </div>
    </div>

    <!-- Product Form Modal (Admin) -->
    <div id="product-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('product-modal')">&times;</span>
            <h2 id="product-modal-title">Nuevo Producto</h2>
            <form id="product-form">
                <input type="hidden" id="prod-id">
                <div class="form-group">
                    <label>Nombre del Producto</label>
                    <input type="text" id="prod-name" required>
                </div>
                <div class="form-group">
                    <label>Precio ($)</label>
                    <input type="number" id="prod-price" required min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>URL de Imagen</label>
                    <input type="url" id="prod-image" required placeholder="https://ejemplo.com/imagen.jpg">
                </div>
                <div class="form-group">
                    <label>Descripción</label>
                    <textarea id="prod-desc" rows="3" style="width: 100%; background: rgba(255,255,255,0.05); color: white; border: 1px solid #333; border-radius: 4px; padding: 10px;" required></textarea>
                </div>
                <button type="submit">Guardar Producto</button>
            </form>
        </div>
    </div>

    <!-- Admin Register Modal -->
    <div id="admin-register-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('admin-register-modal')">&times;</span>
            <h2>Registrar Nuevo Administrador</h2>
            <div id="admin-msg-container" class="message-container" style="display: none;"></div>
            <form id="admin-register-form">
                <div class="form-group">
                    <label>Correo Electrónico</label>
                    <input type="email" id="admin-email" required>
                </div>
                <div class="form-group">
                    <label>Contraseña</label>
                    <input type="password" id="admin-pass" required minlength="6">
                </div>
                <button type="submit">Registrar Admin</button>
            </form>
        </div>
    </div>

    <footer>
        <p>TechStore &copy; 2024</p>
        <div class="user-counter">
            <i class="fas fa-users"></i> Usuarios Registrados: <span id="total-users">Cargando...</span>
        </div>
    </footer>

    <script type="module" src="js/app.js"></script>
    <script>
        // Global modal helpers
        window.openProductModal = (id = null) => {
            const modal = document.getElementById('product-modal');
            const form = document.getElementById('product-form');
            const title = document.getElementById('product-modal-title');
            
            if (id) {
                // Edit mode - fetch data from global state or card (simpler to pass data in onclick but let's use window event or global store)
                // For simplicity, we'll rely on app.js to populate this
                document.dispatchEvent(new CustomEvent('edit-product', { detail: id }));
                title.textContent = 'Editar Producto';
            } else {
                form.reset();
                document.getElementById('prod-id').value = '';
                title.textContent = 'Nuevo Producto';
                modal.style.display = 'flex';
            }
        };

        window.openAdminRegisterModal = () => {
            document.getElementById('admin-register-modal').style.display = 'flex';
        };

        window.closeModal = (id) => {
            document.getElementById(id).style.display = 'none';
        };

        // Close modal on click outside
        window.onclick = (event) => {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        };
    </script>
</body>
</html>
